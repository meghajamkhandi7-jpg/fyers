# ClawWork Integration Checklist (Post-Scaffold)

Goal: Integrate institutional agents into ClawWork safely, with zero-surprise rollout and instant rollback.

Scope: This checklist starts after all scaffold phases are complete.

---

## 0) Preconditions
- [x] Confirm all items are complete in `ROADMAP_CHECKLIST.md`
- [x] Confirm Phase 1 real-data run passed (`phase1_20day_realdata_run_summary.json`)
- [x] Confirm Phase 5 controls still default-safe (`institutional_agent_enabled=false`, dry-run behavior)
- [x] Confirm no direct live-order path changes are required in this step

## 1) Integration Design (Adapter-Only)
- [x] Define a single adapter entrypoint between ClawWork agent flow and institutional decision engine
- [x] Define strict input mapping from ClawWork context -> institutional input contract
- [x] Define strict output mapping from institutional decision -> shadow comparison record
- [x] Ensure adapter has no order execution authority
- [x] Add feature flag guard at adapter call-site (disabled by default)

**Evidence**
- [x] Adapter design note committed under `institutional_agents/reports/` (see `reports/integration_adapter_design_2026-02-18.md`)
- [x] Mapping examples for 3 underlyings (NIFTY50, BANKNIFTY, SENSEX) (see `reports/integration_adapter_design_2026-02-18.md`)

## 2) Shadow Integration (No Order Impact)
- [x] Wire adapter call in shadow mode only
- [x] Keep existing ClawWork decision as primary/live path
- [x] Store side-by-side baseline vs institutional outputs for each decision cycle
- [x] Log confidence, rationale, veto state, and timestamp
- [x] Add daily aggregation artifact for shadow performance review

**Evidence**
- [x] Shadow comparison log file path documented (see `reports/integration_shadow_step2_impl_2026-02-18.md`)
- [x] First daily shadow summary generated (`reports/integration_shadow_2026-02-18_daily_summary.json`)
- [ ] At least 5 consecutive sessions of shadow logs generated

## 3) Safety and Observability
- [x] Add integration-level health checks (input completeness, adapter success rate)
- [x] Add alert for adapter failures above threshold
- [x] Add alert for schema mismatch or missing critical fields
- [x] Add alert for abnormal disagreement spikes vs baseline
- [x] Verify fallback behavior (adapter failure => baseline-only operation)

**Evidence**
- [x] Observability runner implemented (`integration/shadow_observability_report.py`)
- [x] Monitoring report artifact generated (`reports/integration_observability_2026-02-18.json`)
- [x] Alert test artifact generated (`reports/integration_alert_test_2026-02-18.json`)

## 4) Gate Evaluation Before Any Traffic
- [ ] Performance gate met in shadow window
- [ ] Risk gate met in shadow window
- [ ] Reliability gate met (no critical failures)
- [ ] Rollback gate met (flag-off test successful)
- [ ] Sign-off generated by product/risk/engineering owners

**Evidence**
- [ ] Integration gate report JSON (`passed: true`)
- [ ] Integration sign-off markdown

## 5) Progressive Rollout (Feature-Flag Controlled)
- [ ] Stage 1: 5% traffic (time-boxed)
- [ ] Stage 2: 25% traffic (time-boxed)
- [ ] Stage 3: 50% traffic (time-boxed)
- [ ] Stage 4: 100% traffic
- [ ] At each stage, confirm gates remain green before promotion

**Stage Exit Rules**
- [ ] No critical risk incidents
- [ ] No reliability regression
- [ ] No unresolved alerts

## 6) Rollback and Incident Drill
- [ ] Execute rollback drill from active stage to baseline-only mode
- [ ] Verify rollback can be completed within agreed SLA
- [ ] Verify post-rollback system health is normal
- [ ] Document incident response runbook for on-call

**Evidence**
- [ ] Rollback drill report
- [ ] Incident runbook update

## 7) Final Production Closure
- [ ] Publish integration completion report
- [ ] Update `ROADMAP_CHECKLIST.md` with integration completion reference
- [ ] Capture lessons learned and backlog items
- [ ] Freeze integration version and tag release

---

## Execution Notes
- Keep changes minimal and reversible.
- Prefer adapter and logging changes before any routing changes.
- Never couple integration rollout with unrelated feature work.
