import React from 'react';
import { render, screen } from '@testing-library/react';
import { expect } from 'chai';
import sinon from 'sinon';
import ScreenReaderStatusMessage from './ScreenReaderStatusMessage';

describe('ScreenReaderStatusMessage', () => {
  it('should have role="status" on the container before message occurs', () => {
    render(<ScreenReaderStatusMessage message="" />);
    const container = screen.getByRole('status');
    expect(container).to.exist;
  });

  it('should contain the status message inside the container when triggered', () => {
    const testMessage = 'Test status message';
    render(<ScreenReaderStatusMessage message={testMessage} />);
    const container = screen.getByRole('status');
    expect(container).to.contain.text(testMessage);
  });

  it('should allow equivalent visual information to reside in the container', () => {
    const visualElement = <img src="cart.png" alt="Shopping cart with 3 items" />;
    render(<ScreenReaderStatusMessage message={visualElement} />);
    const container = screen.getByRole('status');
    const img = container.querySelector('img');
    expect(img).to.exist;
    expect(img).to.have.attr('alt', 'Shopping cart with 3 items');
  });

  it('should render visible text without affecting accessibility tree when visible prop is true', () => {
    const visibleText = '13 search results found';
    render(<ScreenReaderStatusMessage message={visibleText} visible={true} />);
    
    // Check that visible text is rendered
    expect(screen.getByText(visibleText)).to.exist;
    
    // The visible text should be hidden from accessibility tree
    // This would typically be achieved with aria-hidden="true"
    const visibleElement = screen.getByText(visibleText);
    expect(visibleElement).to.have.attr('aria-hidden', 'true');
  });
});