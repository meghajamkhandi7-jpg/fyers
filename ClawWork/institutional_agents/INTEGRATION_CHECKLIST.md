# ClawWork Integration Checklist (Post-Scaffold)

Goal: Integrate institutional agents into ClawWork safely, with zero-surprise rollout and instant rollback.

Scope: This checklist starts after all scaffold phases are complete.

---

## 0) Preconditions
- [x] Confirm all items are complete in `ROADMAP_CHECKLIST.md`
- [x] Confirm Phase 1 real-data run passed (`phase1_20day_realdata_run_summary.json`)
- [x] Confirm Phase 5 controls still default-safe (`institutional_agent_enabled=false`, dry-run behavior)
- [x] Confirm no direct live-order path changes are required in this step

## 1) Integration Design (Adapter-Only)
- [x] Define a single adapter entrypoint between ClawWork agent flow and institutional decision engine
- [x] Define strict input mapping from ClawWork context -> institutional input contract
- [x] Define strict output mapping from institutional decision -> shadow comparison record
- [x] Ensure adapter has no order execution authority
- [x] Add feature flag guard at adapter call-site (disabled by default)

**Evidence**
- [x] Adapter design note committed under `institutional_agents/reports/` (see `reports/integration_adapter_design_2026-02-18.md`)
- [x] Mapping examples for 3 underlyings (NIFTY50, BANKNIFTY, SENSEX) (see `reports/integration_adapter_design_2026-02-18.md`)

## 2) Shadow Integration (No Order Impact)
- [x] Wire adapter call in shadow mode only
- [x] Keep existing ClawWork decision as primary/live path
- [x] Store side-by-side baseline vs institutional outputs for each decision cycle
- [x] Log confidence, rationale, veto state, and timestamp
- [x] Add daily aggregation artifact for shadow performance review

**Evidence**
- [x] Shadow comparison log file path documented (see `reports/integration_shadow_step2_impl_2026-02-18.md`)
- [x] First daily shadow summary generated (`reports/integration_shadow_2026-02-18_daily_summary.json`)
- [x] At least 5 consecutive sessions of shadow logs generated (`reports/integration_shadow_window_2026-02-18_to_2026-02-22.json`)

## 3) Safety and Observability
- [x] Add integration-level health checks (input completeness, adapter success rate)
- [x] Add alert for adapter failures above threshold
- [x] Add alert for schema mismatch or missing critical fields
- [x] Add alert for abnormal disagreement spikes vs baseline
- [x] Verify fallback behavior (adapter failure => baseline-only operation)

**Evidence**
- [x] Observability runner implemented (`integration/shadow_observability_report.py`)
- [x] Monitoring report artifact generated (`reports/integration_observability_2026-02-18.json`)
- [x] Alert test artifact generated (`reports/integration_alert_test_2026-02-18.json`)

## 4) Gate Evaluation Before Any Traffic
- [x] Performance gate met in shadow window
- [x] Risk gate met in shadow window
- [x] Reliability gate met (no critical failures)
- [x] Rollback gate met (flag-off test successful)
- [x] Sign-off generated by product/risk/engineering owners

**Evidence**
- [x] Integration gate report JSON (`passed: true`, see `reports/integration_gate_2026-02-22.json`)
- [x] Integration sign-off markdown (`reports/integration_signoff_2026-02-22.md`)
- [x] Owner sign-off record (`reports/integration_owner_signoff_2026-02-18.md`)
- [x] Preliminary gate report generated (`reports/integration_gate_2026-02-18.json`, currently `passed: false`)
- [x] Draft sign-off note generated (`reports/integration_signoff_2026-02-18.md`)
- [x] Session-window unblock helper note added (`reports/integration_shadow_window_step4_unblock_2026-02-18.md`)

## 5) Progressive Rollout (Feature-Flag Controlled)
- [x] Stage 1: 5% traffic (time-boxed)
- [x] Stage 2: 25% traffic (time-boxed)
- [x] Stage 3: 50% traffic (time-boxed)
- [x] Stage 4: 100% traffic
- [x] At each stage, confirm gates remain green before promotion

**Evidence**
- [x] Rollout stage tracker implemented (`integration/rollout_stage_tracker.py`)
- [x] Initial Stage-1 rollout assessment generated (`reports/integration_rollout_stage1_assessment_2026-02-22.json`)
- [x] Stage-1 real assessment generated (`reports/integration_rollout_stage1_real_2026-02-22.json`)
- [x] Stage-2 real assessment generated (`reports/integration_rollout_stage2_real_2026-02-22.json`)
- [x] Stage-3 real assessment generated (`reports/integration_rollout_stage3_real_2026-02-22.json`)
- [x] Stage-4 real assessment generated (`reports/integration_rollout_stage4_real_2026-02-22.json`)
- [x] Step 5 implementation note added (`reports/integration_rollout_step5_impl_2026-02-18.md`)

**Stage Exit Rules**
- [x] No critical risk incidents
- [x] No reliability regression
- [x] No unresolved alerts

## 6) Rollback and Incident Drill
- [x] Execute rollback drill from active stage to baseline-only mode
- [x] Verify rollback can be completed within agreed SLA
- [x] Verify post-rollback system health is normal
- [x] Document incident response runbook for on-call

**Evidence**
- [x] Rollback drill report (`reports/integration_rollback_drill_2026-02-18.json`)
- [x] Incident runbook update (`reports/integration_incident_runbook_2026-02-18.md`)

## 7) Final Production Closure
- [x] Publish integration completion report
- [x] Update `ROADMAP_CHECKLIST.md` with integration completion reference
- [x] Capture lessons learned and backlog items
- [x] Freeze integration version and tag release (`integration-v2026.02.18`)

---

## Execution Notes
- Keep changes minimal and reversible.
- Prefer adapter and logging changes before any routing changes.
- Never couple integration rollout with unrelated feature work.
