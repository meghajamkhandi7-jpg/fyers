openapi: 3.0.3
info:
  title: Robot Data Upload API
  version: 1.0.0
  description: API for managing robot mission data uploads to cloud storage
servers:
  - url: https://api.robotfleet.com/v1
    description: Production server
paths:
  /missions/{mission_id}/metadata:
    get:
      summary: Get mission metadata
      description: Retrieve metadata for a specific mission
      parameters:
        - name: mission_id
          in: path
          required: true
          schema:
            type: string
          description: Unique identifier for the mission
      responses:
        '200':
          description: Mission metadata retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MissionMetadata'
        '404':
          description: Mission not found
    put:
      summary: Update mission metadata
      description: Update or create mission metadata
      parameters:
        - name: mission_id
          in: path
          required: true
          schema:
            type: string
          description: Unique identifier for the mission
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MissionMetadata'
      responses:
        '200':
          description: Mission metadata updated successfully
        '201':
          description: Mission metadata created successfully
        '400':
          description: Invalid metadata format

  /missions/{mission_id}/sensors:
    get:
      summary: Get sensor data status
      description: Retrieve upload status for all sensor data associated with a mission
      parameters:
        - name: mission_id
          in: path
          required: true
          schema:
            type: string
          description: Unique identifier for the mission
      responses:
        '200':
          description: Sensor data status retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/SensorDataStatus'
        '404':
          description: Mission not found

  /missions/{mission_id}/sensors/{sensor_id}/upload:
    post:
      summary: Initiate sensor data upload
      description: Initiate upload process for sensor data, prioritizing insight sensors
      parameters:
        - name: mission_id
          in: path
          required: true
          schema:
            type: string
          description: Unique identifier for the mission
        - name: sensor_id
          in: path
          required: true
          schema:
            type: string
          description: Unique identifier for the sensor
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UploadRequest'
      responses:
        '202':
          description: Upload initiated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UploadResponse'
        '400':
          description: Invalid request
        '404':
          description: Mission or sensor not found

  /missions/{mission_id}/sensors/{sensor_id}/upload/{upload_id}:
    patch:
      summary: Resume interrupted upload
      description: Resume an interrupted upload using the upload ID
      parameters:
        - name: mission_id
          in: path
          required: true
          schema:
            type: string
          description: Unique identifier for the mission
        - name: sensor_id
          in: path
          required: true
          schema:
            type: string
          description: Unique identifier for the sensor
        - name: upload_id
          in: path
          required: true
          schema:
            type: string
          description: Unique identifier for the upload session
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ResumeUploadRequest'
      responses:
        '202':
          description: Upload resumed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UploadResponse'
        '400':
          description: Invalid request
        '404':
          description: Upload session not found

  /missions/{mission_id}/completion:
    post:
      summary: Mark mission as complete
      description: Mark a mission as fully completed and ready for processing
      parameters:
        - name: mission_id
          in: path
          required: true
          schema:
            type: string
          description: Unique identifier for the mission
      responses:
        '200':
          description: Mission marked as complete
        '400':
          description: Mission cannot be completed (missing required data)
        '404':
          description: Mission not found

  /robots/{robot_id}/missions:
    get:
      summary: Get missions for a robot
      description: Retrieve all missions associated with a specific robot
      parameters:
        - name: robot_id
          in: path
          required: true
          schema:
            type: string
          description: Unique identifier for the robot
        - name: status
          in: query
          required: false
          schema:
            type: string
            enum: [active, completed, incomplete]
          description: Filter missions by status
      responses:
        '200':
          description: Missions retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/MissionSummary'
        '404':
          description: Robot not found

components:
  schemas:
    MissionMetadata:
      type: object
      required:
        - mission_id
        - robot_id
        - start_time
        - sensor_config
      properties:
        mission_id:
          type: string
          description: Unique identifier for the mission
        robot_id:
          type: string
          description: Unique identifier for the robot
        start_time:
          type: string
          format: date-time
          description: When the mission started
        end_time:
          type: string
          format: date-time
          description: When the mission ended (if completed)
        status:
          type: string
          enum: [active, completed, incomplete, resumed]
          description: Current status of the mission
        sensor_config:
          type: object
          description: Configuration of sensors used in this mission
        objectives_completed:
          type: integer
          description: Number of objectives completed
        total_objectives:
          type: integer
          description: Total number of objectives in the mission

    SensorDataStatus:
      type: object
      required:
        - sensor_id
        - sensor_type
        - data_category
        - upload_status
      properties:
        sensor_id:
          type: string
          description: Unique identifier for the sensor
        sensor_type:
          type: string
          description: Type of sensor (e.g., lidar, camera, thermal)
        data_category:
          type: string
          enum: [insight, payload]
          description: Category of data - insight (customer-facing) or payload (internal)
        upload_status:
          type: string
          enum: [not_started, in_progress, completed, failed]
          description: Current upload status
        file_size_bytes:
          type: integer
          description: Size of the data file in bytes
        last_upload_attempt:
          type: string
          format: date-time
          description: Timestamp of the last upload attempt
        upload_id:
          type: string
          description: ID of the current or last upload session

    UploadRequest:
      type: object
      required:
        - file_size_bytes
        - data_category
        - checksum
      properties:
        file_size_bytes:
          type: integer
          description: Total size of the file to be uploaded in bytes
        data_category:
          type: string
          enum: [insight, payload]
          description: Category of data - insight (high priority) or payload (lower priority)
        checksum:
          type: string
          description: Checksum of the entire file for validation
        file_format:
          type: string
          description: Format of the file (e.g., bin, zip, json)
        resume_from_byte:
          type: integer
          description: Byte position to resume from (for resuming interrupted uploads)

    UploadResponse:
      type: object
      required:
        - upload_id
        - upload_url
        - chunk_size_bytes
      properties:
        upload_id:
          type: string
          description: Unique identifier for this upload session
        upload_url:
          type: string
          description: Pre-signed URL for uploading data chunks
        chunk_size_bytes:
          type: integer
          description: Recommended chunk size for uploads
        expires_at:
          type: string
          format: date-time
          description: When the upload URL expires

    ResumeUploadRequest:
      type: object
      required:
        - resume_from_byte
        - checksum_partial
      properties:
        resume_from_byte:
          type: integer
          description: Byte position to resume from
        checksum_partial:
          type: string
          description: Checksum of the data already uploaded

    MissionSummary:
      type: object
      required:
        - mission_id
        - status
        - start_time
      properties:
        mission_id:
          type: string
          description: Unique identifier for the mission
        status:
          type: string
          enum: [active, completed, incomplete, resumed]
          description: Current status of the mission
        start_time:
          type: string
          format: date-time
          description: When the mission started
        end_time:
          type: string
          format: date-time
          description: When the mission ended (if completed)
        objectives_completed:
          type: integer
          description: Number of objectives completed
        total_objectives:
          type: integer
          description: Total number of objectives in the mission